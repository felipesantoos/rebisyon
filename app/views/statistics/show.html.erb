<% content_for :title, "Statistics" %>
<% content_for :page_title, "Statistics" %>
<% period = @period || "week" %>

<div class="space-y-6" data-controller="statistics" data-statistics-period-value="<%= period %>">
  <%# Scope selector + time range pills %>
  <div class="flex items-center justify-between flex-wrap gap-3">
    <div class="flex items-center gap-3">
      <select class="form-select w-auto">
        <option selected>Whole collection</option>
      </select>
    </div>

    <div class="flex items-center gap-1">
      <%= link_to "1 week", statistics_path(period: "week"), class: period == "week" ? "pill-active" : "pill-inactive" %>
      <%= link_to "1 month", statistics_path(period: "month"), class: period == "month" ? "pill-active" : "pill-inactive" %>
      <%= link_to "1 year", statistics_path(period: "year"), class: period == "year" ? "pill-active" : "pill-inactive" %>
    </div>
  </div>

  <%# Today summary card %>
  <% if @statistics[:today_stats] %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Today</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="stat-card text-center">
          <p class="text-2xl font-bold text-gray-900"><%= @statistics[:today_stats][:studied] %></p>
          <p class="text-xs text-gray-500">Studied</p>
        </div>
        <div class="stat-card text-center">
          <p class="text-2xl font-bold text-gray-900"><%= @statistics[:today_stats][:time_spent] %></p>
          <p class="text-xs text-gray-500">Time</p>
        </div>
        <div class="stat-card text-center">
          <p class="text-2xl font-bold text-green-600"><%= @statistics[:today_stats][:correct_percent] %>%</p>
          <p class="text-xs text-gray-500">Correct</p>
        </div>
        <div class="stat-card text-center">
          <p class="text-2xl font-bold text-blue-600"><%= @statistics[:today_stats][:again_count] %></p>
          <p class="text-xs text-gray-500">Again</p>
        </div>
      </div>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <%# Reviews per day %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Reviews</h2>
      <%= line_chart @statistics[:reviews_per_day],
          colors: ["#3B82F6"],
          library: { scales: { y: { title: { display: true, text: "Reviews" } } } } %>
    </div>

    <%# Card counts (pie) %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Card States</h2>
      <%= pie_chart @statistics[:card_state_breakdown],
          colors: ["#3B82F6", "#F97316", "#22C55E", "#8B5CF6"] %>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <%# Interval distribution (bar) %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Intervals</h2>
      <%= column_chart @statistics[:interval_distribution],
          colors: ["#6366F1"],
          library: { scales: { y: { title: { display: true, text: "Cards" } } } } %>
    </div>

    <%# Retention rate %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Retention Rate</h2>
      <%= column_chart @statistics[:retention_rate],
          colors: ["#22C55E"],
          library: { scales: { y: { title: { display: true, text: "%" }, max: 100 } } } %>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <%# Hourly breakdown (bar) %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Hourly Breakdown</h2>
      <%= column_chart @statistics[:hourly_breakdown],
          colors: ["#14B8A6"],
          library: { scales: { y: { title: { display: true, text: "Reviews" } } } } %>
    </div>

    <%# Review time per day %>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Time Spent (minutes)</h2>
      <%= line_chart @statistics[:review_time_per_day],
          colors: ["#EC4899"],
          library: { scales: { y: { title: { display: true, text: "Minutes" } } } } %>
    </div>
  </div>
</div>
