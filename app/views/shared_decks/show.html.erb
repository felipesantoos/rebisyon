<% content_for :title, @shared_deck.name %>
<% content_for :page_title, @shared_deck.name %>

<div class="max-w-6xl mx-auto space-y-6">
  <%# Back link %>
  <div>
    <%= link_to shared_decks_path, class: "inline-flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Back to Shared Decks
    <% end %>
  </div>

  <%# Two-column layout %>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <%# Main content (2 cols) %>
    <div class="lg:col-span-2 space-y-6">
      <%# Header card %>
      <div class="card">
        <%# Category tag %>
        <span class="tag-chip"><%= @shared_deck.category %></span>

        <%# Title %>
        <h1 class="text-2xl font-bold text-gray-900 mt-2"><%= @shared_deck.name %></h1>

        <%# Author %>
        <p class="text-gray-500 mt-1">by <span class="font-medium text-gray-700"><%= @shared_deck.author.email %></span></p>

        <%# Star rating with count %>
        <div class="flex items-center gap-2 mt-3">
          <span class="inline-flex items-center gap-0.5">
            <% stars = @shared_deck.rating_average || 0 %>
            <% full_stars = stars.floor %>
            <% has_half = (stars - full_stars) >= 0.5 %>
            <% (1..5).each do |i| %>
              <% if i <= full_stars %>
                <span class="text-yellow-400 text-lg">&#9733;</span>
              <% elsif has_half && i == full_stars + 1 %>
                <span class="text-yellow-400 text-lg">&#9733;</span>
              <% else %>
                <span class="text-gray-300 text-lg">&#9733;</span>
              <% end %>
            <% end %>
          </span>
          <span class="text-gray-700 font-semibold"><%= stars %></span>
          <span class="text-gray-500 text-sm">(<%= @ratings.size %> ratings)</span>
        </div>

        <%# Description %>
        <div class="mt-4">
          <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-2">Description</h3>
          <p class="text-gray-700 whitespace-pre-line"><%= @shared_deck.description %></p>
        </div>
      </div>

      <%# Ratings section %>
      <div class="space-y-4">
        <%# Rating form %>
        <%= render "shared_decks/rating_form", shared_deck_id: @shared_deck.id %>

        <%# Existing ratings %>
        <% if @ratings.any? %>
          <div class="card">
            <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3">Reviews (<%= @ratings.size %>)</h3>
            <div class="space-y-4">
              <% @ratings.each do |rating| %>
                <div class="border-b border-gray-100 last:border-0 pb-4 last:pb-0">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <span class="font-medium text-gray-900 text-sm"><%= rating.user.email %></span>
                      <span class="inline-flex items-center gap-0.5">
                        <% (1..5).each do |i| %>
                          <span class="<%= i <= rating.rating ? 'text-yellow-400' : 'text-gray-300' %> text-sm">&#9733;</span>
                        <% end %>
                      </span>
                    </div>
                    <span class="text-xs text-gray-400"><%= rating.created_at.strftime("%Y-%m-%d") %></span>
                  </div>
                  <p class="text-sm text-gray-600 mt-1"><%= rating.comment %></p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <%# Sidebar (1 col) %>
    <div class="space-y-4">
      <%# Download card %>
      <div class="card">
        <%= link_to "#", class: "btn-primary w-full inline-flex items-center justify-center gap-2" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
          </svg>
          Download
        <% end %>

        <dl class="mt-4 space-y-3 text-sm">
          <div class="flex justify-between">
            <dt class="text-gray-500">Size</dt>
            <dd class="font-medium text-gray-900"><%= number_to_human_size(@shared_deck.package_size) %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-gray-500">Downloads</dt>
            <dd class="font-medium text-gray-900"><%= number_with_delimiter(@shared_deck.download_count) %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-gray-500">Last Updated</dt>
            <dd class="font-medium text-gray-900"><%= @shared_deck.updated_at.strftime("%Y-%m-%d") %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-gray-500">Created</dt>
            <dd class="font-medium text-gray-900"><%= @shared_deck.created_at.strftime("%Y-%m-%d") %></dd>
          </div>
        </dl>
      </div>

      <%# Stats card %>
      <div class="card">
        <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3">Stats</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="stat-card text-center">
            <p class="text-2xl font-bold text-gray-900"><%= number_with_delimiter(@shared_deck.download_count) %></p>
            <p class="text-xs text-gray-500 mt-1">Downloads</p>
          </div>
          <div class="stat-card text-center">
            <p class="text-2xl font-bold text-gray-900"><%= @ratings.size %></p>
            <p class="text-xs text-gray-500 mt-1">Ratings</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
