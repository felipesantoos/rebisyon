<%# Browser sidebar: search, decks, note types, tags, flags, saved searches %>
<% data = mock_browser_data[:sidebar] %>

<div class="h-full flex flex-col browser-sidebar">
  <%# Search %>
  <div class="p-3 border-b border-gray-200">
    <div class="relative">
      <input type="text" placeholder="Search..."
             class="form-input pl-8 text-sm"
             data-browser-target="sidebarSearch">
      <svg class="absolute left-2.5 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto p-2 space-y-1">
    <%# Saved Searches %>
    <div data-controller="collapsible" data-collapsible-open-value="true">
      <div class="collapsible-header" data-action="click->collapsible#toggle">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Saved Searches</span>
        <svg data-collapsible-target="icon" class="w-3.5 h-3.5 text-gray-400 transition-transform" style="transform: rotate(90deg)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </div>
      <div data-collapsible-target="content" class="pl-3 space-y-0.5">
        <% data[:saved_searches].each do |search| %>
          <a href="#" class="block px-3 py-1 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded" data-action="click->browser#filterSavedSearch" data-query="<%= search[:query] %>">
            <%= search[:name] %>
          </a>
        <% end %>
      </div>
    </div>

    <%# Decks %>
    <div data-controller="collapsible" data-collapsible-open-value="true">
      <div class="collapsible-header" data-action="click->collapsible#toggle">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Decks</span>
        <svg data-collapsible-target="icon" class="w-3.5 h-3.5 text-gray-400 transition-transform" style="transform: rotate(90deg)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </div>
      <div data-collapsible-target="content" class="pl-3 space-y-0.5">
        <a href="#" class="block px-3 py-1 text-sm text-blue-700 bg-blue-50 rounded font-medium">All Decks (12)</a>
        <% render_sidebar_decks = ->(decks, depth = 0) do %>
          <% decks.each do |deck| %>
            <a href="#" class="block px-3 py-1 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded truncate"
               style="padding-left: <%= 12 + depth * 16 %>px"
               data-action="click->browser#filterDeck"
               data-deck="<%= deck[:full_name] %>">
              <%= deck[:name] %> (<%= deck[:total] %>)
            </a>
            <% if deck[:children].any? %>
              <% render_sidebar_decks.call(deck[:children], depth + 1) %>
            <% end %>
          <% end %>
        <% end %>
        <% render_sidebar_decks.call(data[:decks]) %>
      </div>
    </div>

    <%# Note Types %>
    <div data-controller="collapsible" data-collapsible-open-value="true">
      <div class="collapsible-header" data-action="click->collapsible#toggle">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Note Types</span>
        <svg data-collapsible-target="icon" class="w-3.5 h-3.5 text-gray-400 transition-transform" style="transform: rotate(90deg)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </div>
      <div data-collapsible-target="content" class="pl-3 space-y-0.5">
        <% data[:note_types].each do |nt| %>
          <a href="#" class="block px-3 py-1 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded"
             data-action="click->browser#filterNoteType"
             data-note-type="<%= nt[:name] %>">
            <%= nt[:name] %> (<%= nt[:count] %>)
          </a>
        <% end %>
      </div>
    </div>

    <%# Tags %>
    <div data-controller="collapsible" data-collapsible-open-value="true">
      <div class="collapsible-header" data-action="click->collapsible#toggle">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Tags</span>
        <svg data-collapsible-target="icon" class="w-3.5 h-3.5 text-gray-400 transition-transform" style="transform: rotate(90deg)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </div>
      <div data-collapsible-target="content" class="pl-3 space-y-0.5">
        <% data[:tags].each do |tag| %>
          <a href="#" class="block px-3 py-1 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded"
             data-action="click->browser#filterTag"
             data-tag="<%= tag[:name] %>">
            <%= tag[:name] %> (<%= tag[:count] %>)
          </a>
        <% end %>
      </div>
    </div>

    <%# Flags %>
    <div data-controller="collapsible" data-collapsible-open-value="false">
      <div class="collapsible-header" data-action="click->collapsible#toggle">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Flags</span>
        <svg data-collapsible-target="icon" class="w-3.5 h-3.5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </div>
      <div data-collapsible-target="content" class="hidden pl-3 space-y-0.5">
        <% data[:flags].each do |flag| %>
          <a href="#" class="flex items-center gap-2 px-3 py-1 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded">
            <span class="w-3 h-3 rounded-sm" style="background-color: <%= {red: '#EF4444', orange: '#F97316', green: '#22C55E', blue: '#3B82F6', pink: '#EC4899', teal: '#14B8A6', purple: '#8B5CF6'}[flag[:color].to_sym] || '#6B7280' %>"></span>
            <%= flag[:name] %> (<%= flag[:count] %>)
          </a>
        <% end %>
      </div>
    </div>
  </div>
</div>
