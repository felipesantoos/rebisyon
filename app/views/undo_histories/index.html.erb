<% content_for :title, "Undo History" %>
<% content_for :page_title, "Undo History" %>

<% operation_colors = {
  "edit_note" => "bg-blue-100 text-blue-800",
  "delete_note" => "bg-red-100 text-red-800",
  "move_card" => "bg-purple-100 text-purple-800",
  "change_flag" => "bg-yellow-100 text-yellow-800",
  "add_tag" => "bg-emerald-100 text-emerald-800",
  "remove_tag" => "bg-orange-100 text-orange-800",
  "change_deck" => "bg-indigo-100 text-indigo-800"
} %>

<% type_filters = ["all"] + UndoHistory::OPERATION_TYPES %>

<div class="space-y-6">
  <div class="flex items-center gap-1 flex-wrap">
    <% type_filters.each do |f| %>
      <%= link_to f == "all" ? "All" : f.titleize, undo_histories_path(filter: f), class: @filter == f ? "pill-active" : "pill-inactive" %>
    <% end %>
  </div>

  <% if @history.any? %>
    <div class="space-y-3">
      <% @history.each do |entry| %>
        <%= link_to undo_history_path(entry), class: "card block hover:shadow-md transition-shadow" do %>
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0 mt-0.5">
              <span class="inline-block text-xs font-medium px-2.5 py-1 rounded-full <%= operation_colors[entry.operation_type] || 'bg-gray-100 text-gray-800' %>">
                <%= entry.operation_type.titleize %>
              </span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-gray-900"><%= entry.summary %></p>
              <p class="text-sm text-gray-500 mt-0.5"><%= entry.details %></p>
            </div>
            <div class="flex-shrink-0 text-right">
              <p class="text-xs text-gray-400"><%= entry.created_at.strftime("%Y-%m-%d %H:%M") %></p>
            </div>
            <div class="flex-shrink-0 text-gray-300">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  <% else %>
    <div class="card text-center py-12">
      <h3 class="text-sm font-medium text-gray-900 mb-1">No history</h3>
      <p class="text-sm text-gray-500">No operations matching this filter.</p>
    </div>
  <% end %>
</div>
